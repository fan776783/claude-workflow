# 影响性分析指南

修复前必须完成影响性分析，评估回归风险。

## 1. 依赖链分析

使用 `mcp__auggie-mcp__codebase-retrieval` 查询：
- "What functions/methods call {{问题函数}}?"
- "What modules import {{问题模块}}?"

识别直接调用方和间接调用方。

## 2. 数据流追踪

- 追踪受影响变量/状态的传播路径
- 识别共享状态（全局变量、Context、Store）
- 检查隐式依赖

## 3. 测试覆盖检查

```bash
# 检查相关测试文件
Glob: "**/*.test.{ts,tsx,js,jsx}" 或 "**/*.spec.{ts,tsx,js,jsx}"
Grep: 搜索测试文件中对问题函数/组件的引用
```

## 4. 回归风险评估

| 风险等级 | 条件 | 处理方式 |
|---------|------|---------|
| 高 | 核心模块/多处调用/无测试覆盖 | 必须增加测试 |
| 中 | 有部分调用/部分测试覆盖 | 建议增加测试 |
| 低 | 单一调用/充分测试覆盖 | 可直接修复 |

## 5. 影响清单输出

```markdown
## 影响性分析报告

### 直接影响
- 文件: <受直接影响的文件列表>
- 函数/组件: <受影响的函数或组件>

### 间接影响
- 调用链: <调用关系图>
- 共享状态: <可能受影响的状态>

### 测试覆盖
- 现有测试: <相关测试文件>
- 覆盖率: <是否覆盖修改点>
- 建议: <是否需要补充测试>

### 风险评估
- 等级: 高/中/低
- 原因: <评估理由>
```
