---
description: 智能分析 - 根据描述自动识别场景并执行相应分析
allowed-tools: Task(subagent_type=Explore), Task(subagent_type=senior-code-architect), mcp__codex__codex, Read(*), Write(*), Grep(*), Glob(*), Bash(git *), Bash(pnpm *), Bash(npm *)
examples:
  - /analyze "项目上下文"
    生成结构化上下文摘要
  - /analyze "性能瓶颈"
    分析 Bundle 体积和运行时性能
  - /analyze "用户登录功能在哪"
    探索代码定位实现位置
  - /analyze "这个需求怎么拆解"
    分析和拆解复杂需求
---

# 智能分析

根据用户描述自动识别场景，执行相应的分析策略。

## 场景识别

根据用户输入的关键词和意图，自动匹配以下场景：

| 场景 | 触发关键词 | 执行策略 |
|------|-----------|----------|
| **上下文加载** | 上下文、context、项目结构、代码库概览 | 生成结构化上下文摘要文件 |
| **代码探索** | 在哪、怎么实现、找到、定位、搜索 | 快速搜索文件和代码片段 |
| **深度分析** | 分析、问题、原因、为什么、设计 | Codex 深度分析报告 |
| **性能分析** | 性能、Bundle、体积、加载、优化 | 分析构建产物和运行时性能 |
| **依赖分析** | 依赖、漏洞、安全、版本、冲突 | 依赖关系图和安全审计 |
| **路由分析** | 路由、route、导航、懒加载 | 路由配置和微前端同步分析 |
| **状态分析** | 状态、store、Pinia、Zustand、Redux | 状态管理架构分析 |
| **国际化分析** | 国际化、i18n、翻译、多语言 | 翻译完整性和架构分析 |
| **需求分析** | 需求、拆解、功能点、工作量 | 需求拆解和风险评估 |

## 执行流程

1. **意图识别**：分析用户输入，匹配最相关的场景
2. **策略选择**：根据场景选择对应的分析工具和方法
3. **执行分析**：调用相应的 agent 或工具执行分析
4. **输出报告**：生成结构化的分析报告

## 场景详情

### 上下文加载
- **目标**：快速建立项目认知
- **输出**：`.claude/context-summary-{task}.md`
- **内容**：项目结构、技术栈、核心模块、关键文件

### 代码探索
- **目标**：定位具体实现位置
- **方法**：Glob 文件搜索 + Grep 内容搜索
- **输出**：文件路径、行号、代码片段

### 深度分析
- **目标**：复杂问题的根因分析
- **方法**：Codex agent 深度分析
- **输出**：问题分析、设计建议、潜在风险

### 性能分析
- **目标**：识别性能瓶颈
- **检查项**：
  - Bundle 体积分析（chunk 大小、重复依赖）
  - 加载性能（懒加载、代码分割）
  - 运行时性能（渲染、内存）
- **输出**：性能报告 + 优化建议

### 依赖分析
- **目标**：依赖健康度检查
- **检查项**：
  - 依赖关系图
  - 版本冲突检测
  - 安全漏洞扫描（`pnpm audit`）
  - 重复依赖识别
- **输出**：依赖报告 + 升级建议

### 路由分析
- **目标**：路由配置审查
- **检查项**：
  - 路由结构和层级
  - 懒加载配置
  - 微前端路由同步（如适用）
  - 权限路由守卫
- **输出**：路由结构图 + 优化建议

### 状态分析
- **目标**：状态管理架构审查
- **检查项**：
  - Store 结构和模块划分
  - 状态持久化
  - 跨应用状态共享（微前端场景）
  - 性能问题（不必要的重渲染）
- **输出**：状态架构图 + 优化建议

### 国际化分析
- **目标**：多语言完整性检查
- **检查项**：
  - 翻译键完整性
  - 缺失翻译识别
  - i18n 框架使用规范
- **输出**：翻译完整性报告 + 缺失列表

### 需求分析
- **目标**：需求拆解和评估
- **输出**：
  - 功能点列表
  - 依赖关系
  - 风险评估
  - 工作量估算

## 输出格式

```markdown
# 分析报告

## 场景
<识别到的场景类型>

## 分析目标
<用户输入的描述>

## 分析结果

<根据场景类型输出对应的结构化内容>

## 建议

<可操作的改进建议>
```

## 多场景处理

如果用户描述涉及多个场景，按以下优先级依次执行：
1. 上下文加载（如果是新任务）
2. 代码探索（定位相关代码）
3. 专项分析（性能/依赖/路由等）
4. 深度分析（综合问题分析）

**工作目录**：当前项目目录（自动识别 `process.cwd()`）
